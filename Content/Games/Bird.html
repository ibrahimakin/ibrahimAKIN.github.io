<!DOCTYPE html>
<html>

<head>
	<link rel="icon" href="../../icon.ico" />
	<link rel="stylesheet" href="../../NavBarStyle.css" />
	<title>Games</title>
</head>

<body>
	<ul>
		<li><a href="../../index.html">Home</a></li>
		<li class="dropdown">
			<a href="javascript:void(0)" class="dropbtn">Games</a>
			<div class="dropdown-content">
				<a href="">Bird</a>
				<a href="Snake.html">Snake</a>
			</div>
		</li>
		<li><a href="../LCD-Character-Generator.html">LCD-Character-Generator</a></li>
		<li><a href="../../movies">Movies</a></li>
		<li style="float:right"><a href="https://about.me/iAKIN">About</a></li>
	</ul>
	<table align="center" style="border: 1px solid black;">
		<tr>
			<th>
				<canvas id="canvas" width="800" height="500" style="margin-top:24px; border:1px solid #c3c3c3;">
				</canvas>
				<div id="Score">0</div>
			</th>
			<th align="top">High Score <br />
				<p id="bestScore">0</p>
			</th>
		</tr>
	</table>
	<?php
		$myfile = fopen("newfile.txt", "w+") or die("Unable to open file!");
		$txt = "John Doe\n";
		fwrite($myfile, $txt);
		$txt = "Jane Doe\n";
		fwrite($myfile, $txt);
		fclose($myfile);
	?>
	<script>
		const HEIGHT = 500;
		const WIDTH = 800
		const pipeWidth = 60;
		const minPipe = 40;
		const space = 120;
		const FPS = 120;
		var counter = 0;
		var bestScore = 0;

		function Bird(ctx) {
			this.ctx = ctx;
			this.x = 150;
			this.y = 150;

			this.gravity = 0;
			this.velocity = 0.1;

			this.draw = function () {
				this.ctx.fillStyle = "red";
				this.ctx.beginPath();
				this.ctx.arc(this.x, this.y, 10, 0, Math.PI * 2);
				this.ctx.fill();
			}
			this.update = function () {
				this.gravity += this.velocity;
				this.gravity = Math.min(4, this.gravity);
				this.y += this.gravity;
			}
			this.jump = function () {
				this.gravity = -4;
			}
		}

		function Pipe(ctx, height) {
			this.ctx = ctx;
			this.isDead = false;
			this.Score = true;
			this.x = WIDTH;
			this.y = height ? HEIGHT - height : 0;
			this.width = pipeWidth;

			this.height = height || minPipe + Math.random() * (HEIGHT - space - minPipe * 2);


			this.draw = function () {
				this.ctx.fillStyle = "#000";
				this.ctx.fillRect(this.x, this.y, this.width, this.height);
			}
			this.update = function () {
				this.x -= 1;
				if (this.x + pipeWidth < 150 && this.Score) {
					counter = counter + 0.5;
					this.Score = false;
					document.getElementById("Score").innerHTML = counter;
					if (counter > bestScore) {
						document.getElementById("bestScore").innerHTML = counter;
					}
				}
				if ((this.x + pipeWidth) < 0) {
					this.isDead = true;
				}
			}
		}

		window.onload = function start() {
			document.addEventListener('keydown', onKeyDown);

			var frameCount = 0;
			var c = document.getElementById("canvas");
			var ctx = c.getContext("2d");

			var pipes = generatePipes();
			var birds = [new Bird(ctx)];
			var loop = window.setInterval(gameLoop, 1000 / FPS);

			function onKeyDown(e) {
				if (e.code === 'Space') {
					birds[0].jump();
				}
			}

			function generatePipes() {
				const firstPipe = new Pipe(ctx, null);
				const secondPipeHeight = HEIGHT - firstPipe.height - space;
				const secondPipe = new Pipe(ctx, secondPipeHeight);
				return [firstPipe, secondPipe];
			}

			function gameLoop() {
				update();
				draw();
			}

			function update() {
				frameCount = frameCount + 1;
				if (frameCount % 320 === 0) {
					var pipe = generatePipes();
					pipes.push(...pipe);
				}
				pipes.forEach(myFunction)
				function myFunction(item) {
					item.update();
				}
				pipes = pipes.filter(pipe => !pipe.isDead);

				birds.forEach(myFunction2)
				function myFunction2(item) {
					item.update();
				}

				if (isGameOver()) {
					alert('Game Over!');
					clearInterval(loop);
				}
			}

			function isGameOver() {
				let gameOver = false;
				birds.forEach(bird => {
					pipes.forEach(pipe => {
						if (bird.y < 0 || bird.y > HEIGHT || (
							bird.x > pipe.x && bird.x < pipe.x + pipe.width
							&& bird.y > pipe.y && bird.y < pipe.y + pipe.height)) {
							console.log('game over');
							gameOver = true;
						}
					});
				});
				return gameOver;
			}

			function draw() {
				ctx.clearRect(0, 0, WIDTH, HEIGHT);
				pipes.forEach(myFunction)
				function myFunction(item) {
					item.draw();
				}
				birds.forEach(myFunction2)
				function myFunction2(item) {
					item.draw();
				}
			}
		}
	</script>
</body>

</html>