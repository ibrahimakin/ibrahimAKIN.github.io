<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" href="../../favicon.ico" />
	<link rel="stylesheet" href="./Nav.css" />
	<title>Games</title>
</head>
<body>
<ul id="ul">
	<li id="li"><a id="a" href="/">Home</a></li>
	<li id="li" class="dropdown">
		<a id="a" href="javascript:void(0)" class="dropbtn">Games</a>
		<div class="dropdown-content">
			<a style="padding-top: 0; padding-bottom: 0; height: 0;  visibility: hidden; "> Games </a>
			<a href="/games/bird" style=" border-top-left-radius: 0; border-top-right-radius: 0; ">Bird</a>
			<a href="javascript:void(0)">Snake</a>
			<a href="/games/tetris">Tetris</a>
		</div>
	</li>
	<li id="li"><a id="a" href="/projects/lcd-character-generator">LCD Character Generator</a></li>
	<li id="li"><a id="a" href="#">Movies</a></li>
	<li id="li" style="float:right"><a id="a" href="https://about.me/iAKIN" target="_blank">About</a></li>
</ul>
<div align="center">
	<canvas id="game" width="800" height="500"></canvas>
</div>
<script>
	class SnakeGame {
		constructor() {
			this.canvas = document.getElementById('game');
			this.context = this.canvas.getContext('2d');
			document.addEventListener('keydown', this.onKeyPress.bind(this));
			this.best = localStorage.getItem('snakeBestScore')
			if (!this.best) {
				this.best = 0;
			}
		}

		init() {
			this.positionX = this.positionY = 10;
			this.appleX = this.appleY = 5;
			this.tailSize = 5;
			this.trail = [];
			this.gridSize = /*this.tileCount =*/ 20; //canvas 400x400 kare iken tileCount=20
			this.tileCountX = 40;
			this.tileCountY = 25;
			this.velocityX = this.velocityY = 0;

			this.timer = setInterval(this.loop.bind(this), 1000 / 10);
		}

		reset() {
			clearInterval(this.timer);
			this.init();
		}

		loop() {
			this.update();
			this.draw();
		}

		update() {
			this.positionX += this.velocityX;
			this.positionY += this.velocityY;

			if (this.positionX < 0) {
				this.positionX = this.tileCountX - 1;
			}
			if (this.positionY < 0) {
				this.positionY = this.tileCountY - 1;
			}
			if (this.positionX > this.tileCountX - 1) {
				this.positionX = 0;
			}
			if (this.positionY > this.tileCountY - 1) {
				this.positionY = 0;
			}

			this.trail.forEach(t => {
				if (this.positionX === t.positionX && this.positionY === t.positionY) {
					this.reset();
				}
			});

			this.trail.push({ positionX: this.positionX, positionY: this.positionY });

			while (this.trail.length > this.tailSize) {
				this.trail.shift();
			}

			if (this.appleX === this.positionX && this.appleY === this.positionY) {
				this.tailSize++;
				if (this.tailSize-5 > this.best) {
					this.best = this.tailSize-5;
					localStorage.setItem('snakeBestScore', this.best);
				}
				this.appleX = Math.floor(Math.random() * this.tileCountX);
				this.appleY = Math.floor(Math.random() * this.tileCountY);
			}
		}

		draw() {
			this.context.fillStyle = 'black';
			this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);

			this.context.fillStyle = 'white';
			this.context.font = '20px Arial';
			this.context.fillText('Best ' + this.best, 20, 30);
			this.context.fillText(this.tailSize - 5, 20, 60);

			this.context.fillStyle = 'yellow';
			this.trail.forEach(t => {
				this.context.fillRect(t.positionX * this.gridSize, t.positionY * this.gridSize, this.gridSize - 5, this.gridSize - 5);
			});

			this.context.fillStyle = 'pink';
			this.context.fillRect(this.appleX * this.gridSize, this.appleY * this.gridSize, this.gridSize - 5, this.gridSize - 5);
		}

		onKeyPress(e) {
			if (e.keyCode === 37 && this.velocityX !== 1) {
				this.velocityX = -1;
				this.velocityY = 0;
			}
			if (e.keyCode === 38 && this.velocityY !== 1) {
				this.velocityX = 0;
				this.velocityY = -1;
			}
			if (e.keyCode === 39 && this.velocityX !== -1) {
				this.velocityX = 1;
				this.velocityY = 0;
			}
			if (e.keyCode === 40 && this.velocityY !== -1) {
				this.velocityX = 0;
				this.velocityY = 1;
			}
		}
	}
	const game = new SnakeGame();
	window.onload = () => game.init();
</script>
</body>
</html>